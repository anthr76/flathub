---
app-id: com.vmware.horizon
runtime: org.freedesktop.Platform
runtime-version: '20.08'
sdk: org.freedesktop.Sdk
command: vmware-view
finish-args:
  - "--share=ipc"
  - "--device=dri"
  - "--socket=x11"
  - "--share=network"
  - "--env=LD_LIBRARY_PATH=/app/lib:/app/lib/vmware"
  - "--env=GDK_BACKEND=x11"
  - "--env=ENABLE_FOLDER_REDIRECTION=true"
build-options:
  env:
    VERSION: 2106-8.3.0-18251983
modules:
  - name: glib
    buildsystem: meson
    sources:
      - type: archive
        url: https://download.gnome.org/sources/glib/2.69/glib-2.69.1.tar.xz
        sha256: f92f34057a091fc8638d91f10cece842cb8618e9a1090b0ddb19cc15a21bf39c
  - name: vmware-horizon-client
    buildsystem: simple
    sources:
      - type: archive
        url: https://download3.vmware.com/software/view/viewclients/CART22FQ2/VMware-Horizon-Client-Linux-2106-8.3.0-18251983.tar.gz
        sha256: 368d0b08c1d5be109ab70f692fe9809377f7cf7c20a46bbf72eedf73e59f1035
      - type: file
        path: com.vmware.horizon.metainfo.xml
    build-commands:
      - tar xzvf x64/VMware-Horizon-Client-${VERSION}.x64.tar.gz
      - tar xzvf x64/VMware-Horizon-Client-Linux-ClientSDK-${VERSION}.x64.tar.gz
      - tar xzvf x64/VMware-Horizon-html5mmr-${VERSION}.x64.tar.gz
      - tar xzvf x64/VMware-Horizon-integratedPrinting-${VERSION}.x64.tar.gz
      - tar xzvf x64/VMware-Horizon-PCoIP-${VERSION}.x64.tar.gz
      - tar xzvf x64/VMware-Horizon-scannerClient-${VERSION}.x64.tar.gz
      - tar xzvf x64/VMware-Horizon-serialportClient-${VERSION}.x64.tar.gz
      - tar xzvf x64/VMware-Horizon-TeamsOptimization-${VERSION}.x64.tar.gz
      - tar xzvf x64/VMware-Horizon-USB-${VERSION}.x64.tar.gz
      - tar xzvf x64/VMware-Horizon-USB-sdk-${VERSION}.x64.tar.gz
      - find ./ -name '*.so*' -exec chmod 755 {} +
      - mkdir -p ${FLATPAK_DEST}/lib/vmware/
      - find ./ -name '*.so*' -exec cp -v -n -t ${FLATPAK_DEST}/lib/vmware/ {} +
      - ln -sf /usr/lib/x86_64-linux-gnu/libudev.so.1 "${FLATPAK_DEST}/lib/libudev.so.0"
      - cp -a VMware-Horizon-Client-${VERSION}.x64/lib/vmware/view/bin "${FLATPAK_DEST}"
      - install -Dm644 VMware-Horizon-Client-${VERSION}.x64/share/applications/vmware-view.desktop ${FLATPAK_DEST}/share/applications/com.vmware.horizon.desktop
      - desktop-file-edit --remove-key=Exec ${FLATPAK_DEST}/share/applications/com.vmware.horizon.desktop
      - desktop-file-edit --set-key=Exec --set-value='/app/bin/vmware-view %u' ${FLATPAK_DEST}/share/applications/com.vmware.horizon.desktop
      - desktop-file-edit --remove-key=Icon ${FLATPAK_DEST}/share/applications/com.vmware.horizon.desktop
      - install -Dm644 VMware-Horizon-Client-${VERSION}.x64/share/icons/vmware-view.png ${FLATPAK_DEST}/share/icons/com.vmware.horizon.png
      - desktop-file-edit --set-key=Icon --set-value='/app/share/icons/com.vmware.horizon.png' ${FLATPAK_DEST}/share/applications/com.vmware.horizon.desktop
      - install -Dm 644 -t /app/share/metainfo com.vmware.horizon.metainfo.xml
