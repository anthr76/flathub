---
app-id: com.vmware.horizon
runtime: org.freedesktop.Platform
runtime-version: '20.08'
sdk: org.freedesktop.Sdk
command: vmware-view
finish-args:
  - "--share=ipc"
  - "--device=dri"
  - "--socket=x11"
  - "--share=network"
  - "--env=LD_LIBRARY_PATH=/app/lib:/app/lib/vmware"
build-options:
  env:
    VERSION: 2106-8.3.0-18251983
modules:
  # - name: mm-common
  #   buildsystem: meson
  #   sources:
  #     - type: archive
  #       url: >-
  #         https://download.gnome.org/sources/mm-common/1.0/mm-common-1.0.2.tar.xz
  #       sha256: a2a99f3fa943cf662f189163ed39a2cfc19a428d906dd4f92b387d3659d1641d
  #   cleanup:
  #     - '*'
  # - name: sigc++-3
  #   config-opts:
  #     - '--disable-documentation'
  #   sources:
  #     - type: archive
  #       url: >-
  #         https://download.gnome.org/sources/libsigc++/3.0/libsigc%2B%2B-3.0.7.tar.xz
  #       sha256: bfbe91c0d094ea6bbc6cbd3909b7d98c6561eea8b6d9c0c25add906a6e83d733 
  # - name: glibm
  #   buildsystem: meson
  #   cleanup:
  #     - /lib/glibmm-2.4
  #   sources:
  #     - type: archive
  #       url: https://download.gnome.org/sources/glibmm/2.68/glibmm-2.68.1.tar.xz
  #       sha256: 6664e27c9a9cca81c29e35687f49f2e0d173a2fc9e98c3428311f707db532f8c
  - name: vmware-horizon-client
    buildsystem: simple
    sources:
      - type: archive
        url: https://download3.vmware.com/software/view/viewclients/CART22FQ2/VMware-Horizon-Client-Linux-2106-8.3.0-18251983.tar.gz
        sha256: 368d0b08c1d5be109ab70f692fe9809377f7cf7c20a46bbf72eedf73e59f1035
    build-commands:
      - tar xzvf x64/VMware-Horizon-Client-${VERSION}.x64.tar.gz
      - tar xzvf x64/VMware-Horizon-Client-Linux-ClientSDK-${VERSION}.x64.tar.gz
      - cp -R VMware-Horizon-Client-${VERSION}.x64/lib "${FLATPAK_DEST}"
      - rm VMware-Horizon-Client-Linux-ClientSDK-${VERSION}.x64/lib/vmware/libjson_linux-gcc-4.1.1_libmt.so
      - ln -sf ${FLATPAK_DEST}/lib/libglibmm-2.68.so.1 "${FLATPAK_DEST}/lib/libglibmm-2.4.so.1"
      - ln -sf /usr/lib/x86_64-linux-gnu/libudev.so.1 "${FLATPAK_DEST}/lib/libudev.so.0"
      #- cp -R VMware-Horizon-Client-Linux-ClientSDK-${VERSION}.x64/lib/vmware/ "${FLATPAK_DEST}/lib/vmware/"
      - find VMware-Horizon-Client-Linux-ClientSDK-${VERSION}.x64/lib/vmware/ -name '*.so*' -exec cp -v -n -t ${FLATPAK_DEST}/lib/vmware/ {} +
      - cp -a VMware-Horizon-Client-${VERSION}.x64/lib/vmware/view/bin "${FLATPAK_DEST}"
      - install -Dm644 VMware-Horizon-Client-${VERSION}.x64/share/applications/vmware-view.desktop ${FLATPAK_DEST}/share/application/com.vmware.horizon.desktop
      - install -Dm644 VMware-Horizon-Client-${VERSION}.x64/share/icons/vmware-view.png ${FLATPAK_DEST}/share/icons/com.vmware.horizon.png
